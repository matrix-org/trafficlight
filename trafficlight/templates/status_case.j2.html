{% extends("base.j2.html") %}
{% block content %}
{% if refresh > 0 %}
<script>
setTimeout(function(){
   window.location.reload(1);
}, {{ refresh }});
</script>
{% endif %}
  <h2>{{ test.description }}</h2>
  <p>Clients required: {% for x in test.client_types  %}{{x.name()}} {% endfor %}</p>
  <p>Servers required: {% for x in test.server_types  %}{{x.name()}} {% endfor %}</p>
  {% if test.model %}
  <p>Model data: {{ test.model.data }}</p>
  {% endif %}
  <p>Current status: {{ test.status }}
  {% if test.error %}
<blockquote>
      {{ test.error }}
</blockquote>
  {% endif %}
</p>

<h2>Clients</h2>
{% if test.client_list %}
<table class="table table-small">
    <thead class="thead-dark">
        <tr><th>UUID</th><th>Action</th><th>Registered</th><th>Last Polled</th><th>Last responded</th></tr>
    </thead>
    <tbody>
    {% for client in test.client_list %}
<   <tr>
       <td>{{ client.uuid }}</td>
       <td>{{ client.poll(update_last_polled=False)['action'] }}</td>
       <td>{{ client.registered | delaytime }}</td>
       <td>{{ client.last_polled | delaytime }}</td>
       <td>{{ client.last_responded | delaytime }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% else %}
Clients not allocated yet.
{% endif %}

<a href="{{ url_for("status.test_image", uuid = test.uuid) }}"><img src="{{ url_for("status.test_context_image", uuid = test.uuid) }}" id="test_context_image"></a>

{% endblock %}
